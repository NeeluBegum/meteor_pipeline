...Sat Jun  5 23:17:52 CEST 2021: - begin running script
#!/bin/bash -l
#SBATCH --account=snic2021-5-248
#SBATCH --partition=core
#SBATCH --ntasks=10
#SBATCH --time=2-00:00:00
#SBATCH --job-name=anotherbatch
#SBATCH --mail-user=zn.tportlock@gmail.com
#SBATCH --mail-type=ALL
##SBATCH --output=/proj/uppstore2019028/projects/metagenome/theo/newscripts/meteor/logs/%j 

set -a

function Run {
	echo "...$(date): $1 - begin"
	$@ \
	&& (echo "...$(date): $1 - done"; echo "") \
	|| (echo "...$(date): $1 - failed"; echo ""; exit 1)
}
function Parse_variables {
	v_project_dir=$TMPDIR/$sampleId
	v_workdir="${v_project_dir}/working/$sampleId"
	v_fastqgz1=$(readlink -f ${fastqgzs[0]})
	v_fastqgz2=$(readlink -f ${fastqgzs[1]})
	v_fastqgz1_unzip="${v_workdir}/$(basename $v_fastqgz1 .gz).unzipped"
	v_fastqgz2_unzip="${v_workdir}/$(basename $v_fastqgz2 .gz).unzipped"
	v_trimmedS="${v_workdir}/${sampleId}.trimmed.s.fastq"
	v_final1="${v_workdir}/${sampleId}_1.fastq"
	v_final2="${v_workdir}/${sampleId}_2.fastq"
	v_sampledir=${v_project_dir}/${catalog_type}/sample/${sampleId}
	v_downstream_dir="$v_project_dir/Downstream"
	vars=$(compgen -A variable | grep "^v_.*")
	for var in ${vars}; do echo "${var}=${!var}"; done
	for var in ${vars}; do if [[ -z "${!var}" ]]; then echo "missing argument ${var}" ; return 1 ; fi ; done
}
function Init {
	mkdir -p ${v_project_dir}/${catalog_type}/{sample,mapping,profiles}
	mkdir -p $TMPDIR/reference
	mkdir -p ${v_workdir}
}
function Send {
	cp $v_fastqgz1 ${v_workdir}
	cp $v_fastqgz2 ${v_workdir}
	cp -r ${reference_dir}/* $TMPDIR/reference
	cp -r ${trimFasta} $TMPDIR
}
function Decompress {
	zcat ${v_workdir}/$(basename $v_fastqgz1) > $v_fastqgz1_unzip & pid1=$!
	zcat ${v_workdir}/$(basename $v_fastqgz2) > $v_fastqgz2_unzip & pid2=$!
	trap "kill -2 $pid1 $pid2" SIGINT
	wait
}
function Trim {
	[[ -f $v_fastqgz1_unzip && -f $v_fastqgz2_unzip ]] \
	|| (echo "zip file not found" ; return 1 )
	java -jar ${ALIEN_TRIMMER}/AlienTrimmer.jar \
		-k 10 -l 45 -m 5 -p 40 -q 20 \
		-if ${v_fastqgz1_unzip} -ir ${v_fastqgz2_unzip} -c $TMPDIR/$(basename $trimFasta) \
		-of ${v_final1} -or ${v_final2} -os ${v_trimmedS} \
	|| return 1
}
function Import {
	[[ -f $v_final1 && -f $v_final2 ]] \
	|| (echo "trimmed files not found" ; return 1 )
	mv ${v_final1} ${v_final2} ${v_project_dir}/${catalog_type}/sample &&
	rm -r ${v_workdir}
	ruby ${meteorImportScript} \
		-i ${v_project_dir}/${catalog_type}/sample \
		-p ${catalog_type} \
		-t ${seq_platform} \
		-m "${sampleId}*" \
	|| return 1
}
function Map_reads {
	ruby ${meteor}/meteor.rb \
		-w ${ini_file} \
		-i ${v_sampledir} \
		-p ${v_project_dir}/${catalog_type} \
		-o mapping \
	|| return 1
}
function Quantify {
	${meteor}/meteor-profiler \
		-p ${v_project_dir}/${catalog_type} \
		-f ${v_project_dir}/${catalog_type}/profiles \
		-t smart_shared_reads \
		-w ${ini_file} \
		-o ${sampleId} ${v_project_dir}/${catalog_type}/mapping/${sampleId}/${sampleId}_${v_prefix}_gene_profile/census.dat \
	&& rm -r ${v_project_dir}/${catalog_type}/mapping/${sampleId} \
	|| return 1
}
function Recover {
	rsync -aurvP --remove-source-files $v_project_dir/ $project_dir_rel
}
function PrepareReports {
	inFile=$v_downstream_dir/$1.csv
	outFile=$v_downstream_dir/$1.final.csv
	cat $v_project_dir/$catalog_type/profiles/*$1.csv > $inFile
	head -1 $inFile > ${outFile}.header
	cat $inFile | grep -v sample > ${outFile}.body
	cat ${outFile}.header ${outFile}.body > ${outFile}
	rm ${inFile} ${outFile}.header ${outFile}.body
}
function PrepareGCT {
	inFile=$v_downstream_dir/merged.tsv
	outFile=$v_downstream_dir/merged.final.tsv
	paste $v_project_dir/$catalog_type/profiles/*.tsv > $inFile
	width=$(head -1 $inFile | awk '{print NF}')
	echo $width
	cat $inFile | cut -f1 | sed 's/\#id_fragment/gene_id/g' > ${outFile}.gene
	cat $inFile | awk -v width="$width" 'BEGIN{OFS="\t"}{s="";for(i=2;i<=width;i=i+2){if (i!=width)s=s $i "\t"; if (i==width) s=s $i}; print s}' > ${outFile}.expr
	paste ${outFile}.gene ${outFile}.expr > ${outFile}
	rm ${inFile} ${outFile}.gene ${outFile}.expr
}
function SaveGCT {
	#cd $v_downstream_dir
	Rscript $Rdir/save.gct.r  \
		$v_downstream_dir/merged.final.tsv \
		merged.final \
		$v_downstream_dir \
	|| return 1
}
function Normalize {
	#cd $v_downstream_dir
	Rscript $Rdir/get.norm.downsize.r \
		$v_downstream_dir/merged.final.RData \
		merged.final \
		$v_downstream_dir \
		$v_downstream_dir \
	|| return 1
}
function GetMGS {
	Rscript $Rdir/get.oral.mgs.from.norm.r \
		$v_downstream_dir/merged.final.norm.10M.RData \
		merged.final \
		$v_downstream_dir \
		$v_downstream_dir \
	|| return 1
}

Main() {
	sampleId=$(basename $1 .fastq.gz)
	fastqgzs+=("$2")
	fastqgzs+=("$3")

	Run Parse_variables &&
	Run Init &&
	Run Send &&
	Run Decompress &&
	Run Trim &&
	Run Import &&
	Run Map_reads &&
	Run Quantify &&
	Run Recover
}
Downstream() {
	v_project_dir=$(readlink -f $project_dir_rel)
	v_downstream_dir="$v_project_dir/Downstream"
	mkdir -p $v_downstream_dir

	Run PrepareReports counting_report &&
	Run PrepareReports extended_counting_report &&
	Run PrepareGCT &&
	Run SaveGCT &&
	Run Normalize &&
	Run GetMGS 
}

echo "...$(date): - begin running script"
cat $0
echo ""

# Load modules
echo "...$(date): - load modules"
module load bioinfo-tools
module load ruby/2.6.2
module load AlienTrimmer/0.4.0
module load bowtie2/2.3.4.1
echo "...$(date): - done; echo ''"

# Load ini file
echo "...$(date): - load ini file"
sed -i "s|meteor.reference.dir=.*|meteor.reference.dir=$TMPDIR/reference|g" $1
ini_file=$1
source $ini_file > /dev/null 2>&1
v_prefix=$( grep "meteor.counting.prefix.name" $ini_file | sed "s/^.*=//g" )
cat $ini_file
echo "...$(date): - done; echo ''"

# Run meteor
Main $sample $seq_data_dir/${sample}${forward_identifier} $seq_data_dir/${sample}${reverse_identifier}

# Run the downstream analysis
#Downstream

...Sat Jun  5 23:17:52 CEST 2021: - load modules
Bowtie2 looks for the specified index first in the current directory, then in the directory specified in the BOWTIE2_INDEXES environment variable.
The pregenerated indexes for the reference genonomes are placed under /sw/data/reference/*/*/program_files/bowtie2 for each reference genome
...Sat Jun  5 23:17:59 CEST 2021: - done; echo ''
...Sat Jun  5 23:17:59 CEST 2021: - load ini file
[Pipeline]
sample=P18161_228/02-FASTQ/201104_A00187_0373_BHGM2CDSXY/P18161_228_S101_L004
forward_identifier="_R1_001.fastq.gz"
reverse_identifier="_R2_001.fastq.gz"
seq_data_dir="/proj/snic2020-6-153/delivery04021/P18161"
project_dir_rel="/proj/uppstore2019028/projects/metagenome/theo/newscripts/tmp"
catalog_type="oral_catalog"
seq_platform="illumina"
trimFasta="/proj/uppstore2019028/projects/metagenome/alienTrimmerPF8contaminants.fasta"
meteorImportScript="/proj/uppstore2019028/meteor.2019.11.04/MeteorImportFastq.rb"
meteor="/proj/uppstore2019028/projects/metagenome/software/meteor_linux_2019.11.04"
Rdir="/proj/uppstore2019028/projects/metagenome/meteor_downstream_rscripts"
reference_dir="/proj/uppstore2019028/projects/metagenome/meteor_ref"
[worksession]
meteor.reference.dir=/scratch/20349684/reference
meteor.db.type=binary
meteor.nb.attempts=3
meteor.read.cleaning.program=none
meteor.read.cleaning.cmd=
meteor.mapping.program=bowtie2
meteor.mapping.file.format=sam
meteor.is.cpu.percentage=0
meteor.cpu.count=10
meteor.checksum=md5
meteor.excluded.reference.count=3
[main_reference]
meteor.reference.name=oral_catalog
meteor.matches=10000
meteor.mismatches=5
meteor.is.perc.mismatches=1
meteor.bestalignment=1
meteor.mapper.cmd=
meteor.mapping.prefix.name=mapping_vs_oral_catalog
meteor.counting.prefix.name=vs_hs_10_4_oral_catalog
[excluded_reference_1]
meteor.reference.name=Homo_sapiens_GRCh38
meteor.matches=1
meteor.mismatches=5
meteor.is.perc.mismatches=1
meteor.bestalignment=1
meteor.mapping.prefix.name=mapping_vs_Homo_sapiens_GRCh38
[excluded_reference_2]
meteor.reference.name=A_thaliana_TAIR10
meteor.matches=1
meteor.mismatches=5
meteor.is.perc.mismatches=1
meteor.bestalignment=1
meteor.mapping.prefix.name=mapping_vs_A_thaliana_TAIR10
[excluded_reference_3]
meteor.reference.name=Bos_taurus_UMD3
meteor.matches=1
meteor.mismatches=5
meteor.is.perc.mismatches=1
meteor.bestalignment=1
meteor.mapping.prefix.name=mapping_vs_Bos_taurus_UMD3
...Sat Jun  5 23:18:17 CEST 2021: - done; echo ''
...Sat Jun  5 23:18:17 CEST 2021: Parse_variables - begin
v_downstream_dir=/scratch/20349684/P18161_228_S101_L004/Downstream
v_fastqgz1=/crex/proj/snic2020-6-153/nobackup/delivery04021/P18161/P18161_228/02-FASTQ/201104_A00187_0373_BHGM2CDSXY/P18161_228_S101_L004_R1_001.fastq.gz
v_fastqgz1_unzip=/scratch/20349684/P18161_228_S101_L004/working/P18161_228_S101_L004/P18161_228_S101_L004_R1_001.fastq.unzipped
v_fastqgz2=/crex/proj/snic2020-6-153/nobackup/delivery04021/P18161/P18161_228/02-FASTQ/201104_A00187_0373_BHGM2CDSXY/P18161_228_S101_L004_R2_001.fastq.gz
v_fastqgz2_unzip=/scratch/20349684/P18161_228_S101_L004/working/P18161_228_S101_L004/P18161_228_S101_L004_R2_001.fastq.unzipped
v_final1=/scratch/20349684/P18161_228_S101_L004/working/P18161_228_S101_L004/P18161_228_S101_L004_1.fastq
v_final2=/scratch/20349684/P18161_228_S101_L004/working/P18161_228_S101_L004/P18161_228_S101_L004_2.fastq
v_prefix=vs_hs_10_4_oral_catalog
v_project_dir=/scratch/20349684/P18161_228_S101_L004
v_sampledir=/scratch/20349684/P18161_228_S101_L004/oral_catalog/sample/P18161_228_S101_L004
v_trimmedS=/scratch/20349684/P18161_228_S101_L004/working/P18161_228_S101_L004/P18161_228_S101_L004.trimmed.s.fastq
v_workdir=/scratch/20349684/P18161_228_S101_L004/working/P18161_228_S101_L004
...Sat Jun  5 23:18:17 CEST 2021: Parse_variables - done

...Sat Jun  5 23:18:17 CEST 2021: Init - begin
...Sat Jun  5 23:18:17 CEST 2021: Init - done

...Sat Jun  5 23:18:17 CEST 2021: Send - begin
...Sun Jun  6 00:34:19 CEST 2021: Send - done

...Sun Jun  6 00:34:19 CEST 2021: Decompress - begin
...Sun Jun  6 00:51:00 CEST 2021: Decompress - done

...Sun Jun  6 00:51:00 CEST 2021: Trim - begin
AlienTrimmer main options: -k 10 -l 45 -m 5 -q 20 -p 40 (Phred+33)  /  439 fwd alien sequence(s)  /  7856 fwd k-mers (k=10)  /  439 rev alien sequence(s)  /  7856 rev k-mers (k=10)
[02:01]   1,000,000 read pairs processed:     687,388 trimmed (fwd:     332,999  rev:     354,389)      19,753 removed (fwd:       8,349  rev:      11,404)
[04:03]   2,000,000 read pairs processed:   1,365,001 trimmed (fwd:     657,181  rev:     707,820)      38,864 removed (fwd:      16,140  rev:      22,724)
[06:05]   3,000,000 read pairs processed:   2,035,198 trimmed (fwd:     977,410  rev:   1,057,788)      57,925 removed (fwd:      23,837  rev:      34,088)
[08:08]   4,000,000 read pairs processed:   2,716,917 trimmed (fwd:   1,298,318  rev:   1,418,599)      76,631 removed (fwd:      31,361  rev:      45,270)
[11:20]   5,000,000 read pairs processed:   3,393,672 trimmed (fwd:   1,614,152  rev:   1,779,520)      95,137 removed (fwd:      38,504  rev:      56,633)
[14:37]   6,000,000 read pairs processed:   4,071,536 trimmed (fwd:   1,929,566  rev:   2,141,970)     113,861 removed (fwd:      45,397  rev:      68,464)
[17:46]   7,000,000 read pairs processed:   4,749,363 trimmed (fwd:   2,254,834  rev:   2,494,529)     133,295 removed (fwd:      53,316  rev:      79,979)
[20:51]   8,000,000 read pairs processed:   5,422,249 trimmed (fwd:   2,576,952  rev:   2,845,297)     151,826 removed (fwd:      60,946  rev:      90,880)
[23:51]   9,000,000 read pairs processed:   6,083,232 trimmed (fwd:   2,892,468  rev:   3,190,764)     169,915 removed (fwd:      68,281  rev:     101,634)
[26:43]  10,000,000 read pairs processed:   6,753,935 trimmed (fwd:   3,209,941  rev:   3,543,994)     188,355 removed (fwd:      75,624  rev:     112,731)
[28:47]  11,000,000 read pairs processed:   7,420,169 trimmed (fwd:   3,522,937  rev:   3,897,232)     206,666 removed (fwd:      82,735  rev:     123,931)
[30:53]  12,000,000 read pairs processed:   8,098,904 trimmed (fwd:   3,839,353  rev:   4,259,551)     225,720 removed (fwd:      89,915  rev:     135,805)
[33:00]  13,000,000 read pairs processed:   8,784,975 trimmed (fwd:   4,163,377  rev:   4,621,598)     245,216 removed (fwd:      97,493  rev:     147,723)
[35:04]  14,000,000 read pairs processed:   9,459,700 trimmed (fwd:   4,486,508  rev:   4,973,192)     263,403 removed (fwd:     105,012  rev:     158,391)
[37:10]  15,000,000 read pairs processed:  10,118,953 trimmed (fwd:   4,801,014  rev:   5,317,939)     281,659 removed (fwd:     112,339  rev:     169,320)
[39:13]  16,000,000 read pairs processed:  10,786,075 trimmed (fwd:   5,115,841  rev:   5,670,234)     300,087 removed (fwd:     119,696  rev:     180,391)
[41:16]  17,000,000 read pairs processed:  11,453,557 trimmed (fwd:   5,429,598  rev:   6,023,959)     318,584 removed (fwd:     126,845  rev:     191,739)
[43:19]  18,000,000 read pairs processed:  12,129,155 trimmed (fwd:   5,744,274  rev:   6,384,881)     337,399 removed (fwd:     134,055  rev:     203,344)
[45:24]  19,000,000 read pairs processed:  12,812,790 trimmed (fwd:   6,061,684  rev:   6,751,106)     356,384 removed (fwd:     141,178  rev:     215,206)
[47:26]  20,000,000 read pairs processed:  13,471,624 trimmed (fwd:   6,378,366  rev:   7,093,258)     374,476 removed (fwd:     148,694  rev:     225,782)
[49:30]  21,000,000 read pairs processed:  14,128,474 trimmed (fwd:   6,690,866  rev:   7,437,608)     392,839 removed (fwd:     156,170  rev:     236,669)
[51:35]  22,000,000 read pairs processed:  14,786,714 trimmed (fwd:   7,002,288  rev:   7,784,426)     411,293 removed (fwd:     163,614  rev:     247,679)
[53:41]  23,000,000 read pairs processed:  15,445,150 trimmed (fwd:   7,312,402  rev:   8,132,748)     429,419 removed (fwd:     170,685  rev:     258,734)
[55:47]  24,000,000 read pairs processed:  16,111,304 trimmed (fwd:   7,624,684  rev:   8,486,620)     447,743 removed (fwd:     177,848  rev:     269,895)
[57:56]  25,000,000 read pairs processed:  16,783,672 trimmed (fwd:   7,937,848  rev:   8,845,824)     465,877 removed (fwd:     184,761  rev:     281,116)
[60:03]  26,000,000 read pairs processed:  17,461,128 trimmed (fwd:   8,259,309  rev:   9,201,819)     483,936 removed (fwd:     192,155  rev:     291,781)
[62:08]  27,000,000 read pairs processed:  18,122,189 trimmed (fwd:   8,572,732  rev:   9,549,457)     501,902 removed (fwd:     199,537  rev:     302,365)
[64:13]  28,000,000 read pairs processed:  18,784,736 trimmed (fwd:   8,884,642  rev:   9,900,094)     519,902 removed (fwd:     206,823  rev:     313,079)
[66:18]  29,000,000 read pairs processed:  19,454,042 trimmed (fwd:   9,197,569  rev:  10,256,473)     538,103 removed (fwd:     214,016  rev:     324,087)
[68:24]  30,000,000 read pairs processed:  20,119,678 trimmed (fwd:   9,509,180  rev:  10,610,498)     556,016 removed (fwd:     221,036  rev:     334,980)
[70:34]  31,000,000 read pairs processed:  20,788,996 trimmed (fwd:   9,821,767  rev:  10,967,229)     573,981 removed (fwd:     228,019  rev:     345,962)
[72:43]  32,000,000 read pairs processed:  21,464,443 trimmed (fwd:  10,141,942  rev:  11,322,501)     592,711 removed (fwd:     235,673  rev:     357,038)
[74:51]  33,000,000 read pairs processed:  22,128,940 trimmed (fwd:  10,463,958  rev:  11,664,982)     611,304 removed (fwd:     243,408  rev:     367,896)
[76:56]  34,000,000 read pairs processed:  22,786,857 trimmed (fwd:  10,780,372  rev:  12,006,485)     629,684 removed (fwd:     251,011  rev:     378,673)
[79:01]  35,000,000 read pairs processed:  23,443,759 trimmed (fwd:  11,095,509  rev:  12,348,250)     648,401 removed (fwd:     258,756  rev:     389,645)
[81:06]  36,000,000 read pairs processed:  24,095,048 trimmed (fwd:  11,405,932  rev:  12,689,116)     666,521 removed (fwd:     266,261  rev:     400,260)
[83:14]  37,000,000 read pairs processed:  24,753,397 trimmed (fwd:  11,717,384  rev:  13,036,013)     684,565 removed (fwd:     273,451  rev:     411,114)
[85:24]  38,000,000 read pairs processed:  25,429,428 trimmed (fwd:  12,035,008  rev:  13,394,420)     702,549 removed (fwd:     280,451  rev:     422,098)
[87:32]  39,000,000 read pairs processed:  26,283,149 trimmed (fwd:  12,436,161  rev:  13,846,988)     724,320 removed (fwd:     288,713  rev:     435,607)
[89:40]  40,000,000 read pairs processed:  27,097,597 trimmed (fwd:  12,818,415  rev:  14,279,182)     746,682 removed (fwd:     296,939  rev:     449,743)
[91:48]  41,000,000 read pairs processed:  27,873,347 trimmed (fwd:  13,184,109  rev:  14,689,238)     768,655 removed (fwd:     305,462  rev:     463,193)
[93:57]  42,000,000 read pairs processed:  28,602,930 trimmed (fwd:  13,530,910  rev:  15,072,020)     788,559 removed (fwd:     314,085  rev:     474,474)
[96:06]  43,000,000 read pairs processed:  29,319,369 trimmed (fwd:  13,869,323  rev:  15,450,046)     808,306 removed (fwd:     322,297  rev:     486,009)
[98:16]  44,000,000 read pairs processed:  30,059,344 trimmed (fwd:  14,216,815  rev:  15,842,529)     828,297 removed (fwd:     330,644  rev:     497,653)
[100:26]  45,000,000 read pairs processed:  30,850,289 trimmed (fwd:  14,588,716  rev:  16,261,573)     847,705 removed (fwd:     338,608  rev:     509,097)
[102:36]  46,000,000 read pairs processed:  31,626,682 trimmed (fwd:  14,949,474  rev:  16,677,208)     867,453 removed (fwd:     346,633  rev:     520,820)
[104:43]  47,000,000 read pairs processed:  32,363,363 trimmed (fwd:  15,294,281  rev:  17,069,082)     887,083 removed (fwd:     355,013  rev:     532,070)
[106:48]  48,000,000 read pairs processed:  33,091,919 trimmed (fwd:  15,633,402  rev:  17,458,517)     906,994 removed (fwd:     363,390  rev:     543,604)
[108:54]  49,000,000 read pairs processed:  33,809,034 trimmed (fwd:  15,966,675  rev:  17,842,359)     926,460 removed (fwd:     371,356  rev:     555,104)
[111:04]  50,000,000 read pairs processed:  34,533,123 trimmed (fwd:  16,307,194  rev:  18,225,929)     946,201 removed (fwd:     379,583  rev:     566,618)
[113:12]  51,000,000 read pairs processed:  35,278,020 trimmed (fwd:  16,662,959  rev:  18,615,061)     965,683 removed (fwd:     387,805  rev:     577,878)
[115:20]  52,000,000 read pairs processed:  36,012,365 trimmed (fwd:  17,010,436  rev:  19,001,929)     984,978 removed (fwd:     395,895  rev:     589,083)
[117:26]  53,000,000 read pairs processed:  36,735,648 trimmed (fwd:  17,351,634  rev:  19,384,014)   1,004,597 removed (fwd:     404,311  rev:     600,286)
[119:34]  54,000,000 read pairs processed:  37,450,568 trimmed (fwd:  17,688,613  rev:  19,761,955)   1,024,264 removed (fwd:     412,675  rev:     611,589)
[121:42]  55,000,000 read pairs processed:  38,161,613 trimmed (fwd:  18,021,699  rev:  20,139,914)   1,043,626 removed (fwd:     420,529  rev:     623,097)
[123:51]  56,000,000 read pairs processed:  38,877,441 trimmed (fwd:  18,356,542  rev:  20,520,899)   1,063,185 removed (fwd:     428,631  rev:     634,554)
[125:59]  57,000,000 read pairs processed:  39,597,421 trimmed (fwd:  18,697,765  rev:  20,899,656)   1,082,262 removed (fwd:     436,958  rev:     645,304)
[128:07]  58,000,000 read pairs processed:  40,305,541 trimmed (fwd:  19,031,911  rev:  21,273,630)   1,100,943 removed (fwd:     445,095  rev:     655,848)
[130:11]  59,000,000 read pairs processed:  41,021,293 trimmed (fwd:  19,367,422  rev:  21,653,871)   1,120,435 removed (fwd:     453,450  rev:     666,985)
[132:17]  60,000,000 read pairs processed:  41,732,014 trimmed (fwd:  19,700,415  rev:  22,031,599)   1,139,664 removed (fwd:     461,490  rev:     678,174)
[134:25]  61,000,000 read pairs processed:  42,439,382 trimmed (fwd:  20,029,312  rev:  22,410,070)   1,158,669 removed (fwd:     469,316  rev:     689,353)
[136:33]  62,000,000 read pairs processed:  43,151,069 trimmed (fwd:  20,362,378  rev:  22,788,691)   1,177,582 removed (fwd:     477,097  rev:     700,485)
[138:39]  63,000,000 read pairs processed:  43,870,688 trimmed (fwd:  20,707,414  rev:  23,163,274)   1,196,536 removed (fwd:     485,186  rev:     711,350)
[140:50]  64,000,000 read pairs processed:  44,587,264 trimmed (fwd:  21,047,958  rev:  23,539,306)   1,215,482 removed (fwd:     493,286  rev:     722,196)
[143:17]  65,000,000 read pairs processed:  45,299,577 trimmed (fwd:  21,385,351  rev:  23,914,226)   1,234,314 removed (fwd:     501,282  rev:     733,032)
[145:53]  66,000,000 read pairs processed:  46,014,460 trimmed (fwd:  21,723,177  rev:  24,291,283)   1,253,689 removed (fwd:     509,521  rev:     744,168)
[149:42]  67,000,000 read pairs processed:  46,720,331 trimmed (fwd:  22,055,283  rev:  24,665,048)   1,272,808 removed (fwd:     517,453  rev:     755,355)
[156:21]  68,000,000 read pairs processed:  47,439,196 trimmed (fwd:  22,392,935  rev:  25,046,261)   1,291,752 removed (fwd:     525,132  rev:     766,620)
[164:43]  69,000,000 read pairs processed:  48,214,039 trimmed (fwd:  22,760,868  rev:  25,453,171)   1,312,074 removed (fwd:     533,979  rev:     778,095)
[171:18]  70,000,000 read pairs processed:  48,948,695 trimmed (fwd:  23,109,947  rev:  25,838,748)   1,331,641 removed (fwd:     542,391  rev:     789,250)
[177:55]  71,000,000 read pairs processed:  49,690,670 trimmed (fwd:  23,459,975  rev:  26,230,695)   1,351,211 removed (fwd:     550,779  rev:     800,432)
[183:48]  72,000,000 read pairs processed:  50,407,657 trimmed (fwd:  23,798,734  rev:  26,608,923)   1,370,756 removed (fwd:     559,306  rev:     811,450)
[190:00]  73,000,000 read pairs processed:  51,121,598 trimmed (fwd:  24,133,027  rev:  26,988,571)   1,390,080 removed (fwd:     567,491  rev:     822,589)
[194:31]  73,816,214 read pairs processed:  51,696,658 trimmed (fwd:  24,402,191  rev:  27,294,467)   1,405,733 removed (fwd:     574,006  rev:     831,727)
...Sun Jun  6 04:05:32 CEST 2021: Trim - done

...Sun Jun  6 04:05:32 CEST 2021: Import - begin
ruby: warning: shebang line ending with \r may cause problems
Import /scratch/20349684/P18161_228_S101_L004/oral_catalog/sample/P18161_228_S101_L004_2.fastq
Import /scratch/20349684/P18161_228_S101_L004/oral_catalog/sample/P18161_228_S101_L004_1.fastq
Importation done!
...Sun Jun  6 04:05:45 CEST 2021: Import - done

...Sun Jun  6 04:05:45 CEST 2021: Map_reads - begin
/proj/uppstore2019028/projects/metagenome/software/meteor_linux_2019.11.04/meteor.rb:146: warning: constant ::Fixnum is deprecated
/proj/uppstore2019028/projects/metagenome/software/meteor_linux_2019.11.04/meteor.rb:161: warning: Insecure world writable dir /proj/uppstore2019028/Helen/meteor-linux.2019-11-04 in PATH, mode 042777

Launch mapping


######### Meteor Mapping task description
Sample name = P18161_228_S101_L004
Library name = P18161_228_S101_L004_1
Project name = oral_catalog
Sequencing device = illumina
Workflow = P18161_228_S101_L004.ini

######### Task main mapping 0
Executing mapping command:
bowtie2-align-l --mm -p 10 --end-to-end --sensitive -k 10000 --no-head --no-sq --no-unal --omit-sec-seq -x /scratch/20349684/reference/oral_catalog/fasta/oral_catalog_dnaspace_index -U /scratch/20349684/P18161_228_S101_L004/oral_catalog/sample/P18161_228_S101_L004/37d18950a3fce4412ba796b65508c9c6/P18161_228_S101_L004_1.fastq.idx -S /scratch/20349684/P18161_228_S101_L004/oral_catalog/mapping/P18161_228_S101_L004/mapping_vs_oral_catalog_P18161_228_S101_L004_1/P18161_228_S101_L004_1_1.sam
72640529 reads; of these:
  72640529 (100.00%) were unpaired; of these:
    57784167 (79.55%) aligned 0 times
    2572685 (3.54%) aligned exactly 1 time
    12283677 (16.91%) aligned >1 times
20.45% overall alignment rate

######### TaskExcludedMapping(0, 1) ; reference name: Homo_sapiens_GRCh38
Executing mapping command:
bowtie2-align-l --mm -p 10 --end-to-end --sensitive -k 1 --no-head --no-sq --no-unal --omit-sec-seq -x /scratch/20349684/reference/Homo_sapiens_GRCh38/fasta/Homo_sapiens_GRCh38_dnaspace_index -U /scratch/20349684/P18161_228_S101_L004/oral_catalog/sample/P18161_228_S101_L004/37d18950a3fce4412ba796b65508c9c6/P18161_228_S101_L004_1.fastq.idx -S /scratch/20349684/P18161_228_S101_L004/oral_catalog/mapping/P18161_228_S101_L004/mapping_vs_Homo_sapiens_GRCh38_P18161_228_S101_L004_1/P18161_228_S101_L004_1_1.sam
72640529 reads; of these:
  72640529 (100.00%) were unpaired; of these:
    12534652 (17.26%) aligned 0 times
    60105877 (82.74%) aligned exactly 1 time
    0 (0.00%) aligned >1 times
82.74% overall alignment rate

######### TaskExcludedMapping(0, 2) ; reference name: A_thaliana_TAIR10
Executing mapping command:
bowtie2-align-l --mm -p 10 --end-to-end --sensitive -k 1 --no-head --no-sq --no-unal --omit-sec-seq -x /scratch/20349684/reference/A_thaliana_TAIR10/fasta/A_thaliana_TAIR10_dnaspace_index -U /scratch/20349684/P18161_228_S101_L004/oral_catalog/sample/P18161_228_S101_L004/37d18950a3fce4412ba796b65508c9c6/P18161_228_S101_L004_1.fastq.idx -S /scratch/20349684/P18161_228_S101_L004/oral_catalog/mapping/P18161_228_S101_L004/mapping_vs_A_thaliana_TAIR10_P18161_228_S101_L004_1/P18161_228_S101_L004_1_1.sam
72640529 reads; of these:
  72640529 (100.00%) were unpaired; of these:
    72630413 (99.99%) aligned 0 times
    10116 (0.01%) aligned exactly 1 time
    0 (0.00%) aligned >1 times
0.01% overall alignment rate

######### TaskExcludedMapping(0, 3) ; reference name: Bos_taurus_UMD3
Executing mapping command:
bowtie2-align-l --mm -p 10 --end-to-end --sensitive -k 1 --no-head --no-sq --no-unal --omit-sec-seq -x /scratch/20349684/reference/Bos_taurus_UMD3/fasta/Bos_taurus_UMD3_dnaspace_index -U /scratch/20349684/P18161_228_S101_L004/oral_catalog/sample/P18161_228_S101_L004/37d18950a3fce4412ba796b65508c9c6/P18161_228_S101_L004_1.fastq.idx -S /scratch/20349684/P18161_228_S101_L004/oral_catalog/mapping/P18161_228_S101_L004/mapping_vs_Bos_taurus_UMD3_P18161_228_S101_L004_1/P18161_228_S101_L004_1_1.sam
72640529 reads; of these:
  72640529 (100.00%) were unpaired; of these:
    71658480 (98.65%) aligned 0 times
    982049 (1.35%) aligned exactly 1 time
    0 (0.00%) aligned >1 times
1.35% overall alignment rate
removing re-indexed file:
/scratch/20349684/P18161_228_S101_L004/oral_catalog/sample/P18161_228_S101_L004/37d18950a3fce4412ba796b65508c9c6/P18161_228_S101_L004_1.fastq.idx


######### Meteor Mapping task description
Sample name = P18161_228_S101_L004
Library name = P18161_228_S101_L004_2
Project name = oral_catalog
Sequencing device = illumina
Workflow = P18161_228_S101_L004.ini

######### Task main mapping 1
Executing mapping command:
bowtie2-align-l --mm -p 10 --end-to-end --sensitive -k 10000 --no-head --no-sq --no-unal --omit-sec-seq -x /scratch/20349684/reference/oral_catalog/fasta/oral_catalog_dnaspace_index -U /scratch/20349684/P18161_228_S101_L004/oral_catalog/sample/P18161_228_S101_L004/37d18950a3fce4412ba796b65508c9c6/P18161_228_S101_L004_2.fastq.idx -S /scratch/20349684/P18161_228_S101_L004/oral_catalog/mapping/P18161_228_S101_L004/mapping_vs_oral_catalog_P18161_228_S101_L004_2/P18161_228_S101_L004_2_1.sam
72640529 reads; of these:
  72640529 (100.00%) were unpaired; of these:
    57905199 (79.71%) aligned 0 times
    2563446 (3.53%) aligned exactly 1 time
    12171884 (16.76%) aligned >1 times
20.29% overall alignment rate

######### TaskExcludedMapping(1, 1) ; reference name: Homo_sapiens_GRCh38
Executing mapping command:
bowtie2-align-l --mm -p 10 --end-to-end --sensitive -k 1 --no-head --no-sq --no-unal --omit-sec-seq -x /scratch/20349684/reference/Homo_sapiens_GRCh38/fasta/Homo_sapiens_GRCh38_dnaspace_index -U /scratch/20349684/P18161_228_S101_L004/oral_catalog/sample/P18161_228_S101_L004/37d18950a3fce4412ba796b65508c9c6/P18161_228_S101_L004_2.fastq.idx -S /scratch/20349684/P18161_228_S101_L004/oral_catalog/mapping/P18161_228_S101_L004/mapping_vs_Homo_sapiens_GRCh38_P18161_228_S101_L004_2/P18161_228_S101_L004_2_1.sam
slurmstepd: error: *** JOB 20349684 ON r403 CANCELLED AT 2021-06-07T23:17:51 DUE TO TIME LIMIT ***
